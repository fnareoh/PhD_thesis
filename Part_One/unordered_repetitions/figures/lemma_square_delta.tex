\newcommand{\deltaphrase}[4]{% (start_x, start_y),head,tail,label
\node (p) at #1 {};
\draw (p) rectangle ++(#2,-0.5); %draw head
\draw[fill=gray!20] ($(p)+(#2,0)$) rectangle ++(#3,-0.5); %draw tail
\node[yshift=-0.75cm] (label) at ($(p)+(.5*#2+.5*#3,0)$) {#4};% label
}

\begin{figure}
\centering

\begin{tikzpicture}[scale=0.7, every node/.style={scale=1}]
\node[label=above:{$x$}] (x) at (1,0.5) {};
\node[label=above:{$y$}] (y) at (17,0.5) {};
\draw (x) rectangle ($(y)+(0,-0.5)$);
%extensions T
\node at (-0.5,1) {$T$};
\draw[dashed] ($(x)+(0,0)$) -- ($(x)+(-1,0)$);
\draw[dashed] ($(x)+(0,-0.5)$) -- ($(x)+(-1,-0.5)$);
\draw[dashed] ($(y)+(0,0)$) -- ($(y)+(1,0)$);
\draw[dashed] ($(y)+(0,-0.5)$) -- ($(y)+(1,-0.5)$);
%square
\node[label=above:{$s$}] (s) at (7,0.5) {};
\node[label=above:{$s+\ell$}] (splusl) at ($(s)+(2,0)$) {};
\draw[fill=gray!80] (s) rectangle ++(2,-0.5);
\draw[fill=gray!80] (splusl) rectangle ++(2,-0.5);

%decomposision

%case 1
\draw[gray] ($(x)+(0,-1)$) rectangle ($(y)+(0,-1.5)$);
\deltaphrase{(1,-0.5)}{0.2}{1}{$b_1$}
\deltaphrase{(2.2,-0.5)}{1}{0.3}{$b_2$}
\deltaphrase{($(splusl)+(0.5,-1)$)}{0.2}{1.3}{$b_i$}
\node[gray] at (6.5,-0.75) {$\dots$};
\node[gray] at (13,-0.75) {$\dots$};
\deltaphrase{($(y)+(-2.2,-1)$)}{0.4}{1.8}{$b_z$}

%case 2
\draw[gray] ($(x)+(0,-2.5)$) rectangle ($(y)+(0,-3)$);
\deltaphrase{(1,-2)}{0.2}{1}{$b_1$}
\deltaphrase{(2.2,-2)}{1}{0.3}{$b_2$}
\deltaphrase{($(s)+(-0.5,-2.5)$)}{1}{5}{$b_i$}
\node[gray] at (5,-2.25) {$\dots$};
\node[gray] at (13.5,-2.25) {$\dots$};
\deltaphrase{($(y)+(-2.2,-2.5)$)}{0.4}{1.8}{$b_z$}
\end{tikzpicture}


\caption{Illustration of the two cases of Lemma~\ref{lem:use}.}\label{fig:lem_square_Delta}
\end{figure}
